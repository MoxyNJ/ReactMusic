{"ast":null,"code":"import * as actionTypes from \"./constants\";\nimport { getSongDetail } from \"@/services/player\";\nimport { getRandomNumber } from \"@/utils/math-utils\";\n\nconst changeCurrentSongAction = res => ({\n  type: actionTypes.CHANGE_CURRENT_SONG,\n  currentSong: res\n});\n\nconst changePlayListAction = playList => ({\n  type: actionTypes.CHANGE_PLAY_LIST,\n  playList\n});\n\nconst changeCurrentSongIndexAction = index => ({\n  type: actionTypes.CHANGE_CURRENT_SONG_INDEX,\n  index\n});\n\nexport const changeSequenceAction = sequence => ({\n  type: actionTypes.CHANGE_SEQUENCE,\n  sequence\n}); // 上一首，下一首\n\nexport const changeSongPlayerAction = tag => {\n  return (dispatch, getState) => {\n    const playList = getState().getIn([\"player\", \"playList\"]);\n    const sequence = getState().getIn([\"player\", \"sequence\"]);\n    let currentSongIndex = getState().getIn([\"player\", \"currentSongIndex\"]);\n\n    switch (sequence) {\n      case 1:\n        // 随机播放\n        let randomIndex = getRandomNumber(playList.length);\n\n        while (randomIndex === currentSongIndex) {\n          randomIndex = getRandomNumber(playList.length);\n        }\n\n        currentSongIndex = randomIndex;\n        break;\n\n      default:\n        // 顺序 / 单曲播放\n        currentSongIndex += tag;\n        if (currentSongIndex >= playList.length) currentSongIndex = 0;\n        if (currentSongIndex < 0) currentSongIndex = playList.length - 1;\n        break;\n        const currentSong = playList[currentSongIndex];\n    }\n  };\n};\nexport const getSongDetailAction = idx => {\n  return (dispatch, getState) => {\n    // 1.根据ids查找playList中是否已经有该歌曲\n    const playList = getState().getIn([\"player\", \"playList\"]);\n    const songIndex = playList.findIndex(item => item.id === idx); // 如果返回的是大于0的下标，则表明找到了。\n\n    if (songIndex !== -1) {\n      dispatch(changeCurrentSongIndexAction(songIndex));\n      const songIds = playList[songIndex];\n      dispatch(changeCurrentSongAction(songIds));\n    } else {\n      // 如果返回的是-1，则表明没找到，则请求歌曲\n      getSongDetail(idx).then(res => {\n        // res.songs && 防止 songs 是 undefined\n        const song = res.songs && res.songs[0]; // !song 防止 song 是 undefined，如果是 undefined什么也不做，直接结束执行\n\n        if (!song) return; // 1.将最新请求的歌曲添加到播放列表中\n\n        const newPlayList = [...playList];\n        newPlayList.push(song); // 2.更新redux中的值\n\n        dispatch(changePlayListAction(newPlayList));\n        dispatch(changeCurrentSongIndexAction(newPlayList.length - 1));\n        dispatch(changeCurrentSongAction(song));\n      });\n    } // 列表中有歌曲，直接播放。\n    // 列表中没有歌曲，添加歌曲。\n\n\n    getSongDetail(idx).then(res => {\n      dispatch(changeCurrentSongAction(res.songs[0]));\n    });\n  };\n};","map":{"version":3,"sources":["F:/ReactTea/moxy-music-react/src/pages/player/store/actionCreators.js"],"names":["actionTypes","getSongDetail","getRandomNumber","changeCurrentSongAction","res","type","CHANGE_CURRENT_SONG","currentSong","changePlayListAction","playList","CHANGE_PLAY_LIST","changeCurrentSongIndexAction","index","CHANGE_CURRENT_SONG_INDEX","changeSequenceAction","sequence","CHANGE_SEQUENCE","changeSongPlayerAction","tag","dispatch","getState","getIn","currentSongIndex","randomIndex","length","getSongDetailAction","idx","songIndex","findIndex","item","id","songIds","then","song","songs","newPlayList","push"],"mappings":"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","sourcesContent":["import * as actionTypes from \"./constants\";\r\n\r\nimport { getSongDetail } from \"@/services/player\";\r\nimport { getRandomNumber } from \"@/utils/math-utils\";\r\n\r\nconst changeCurrentSongAction = (res) => ({\r\n  type: actionTypes.CHANGE_CURRENT_SONG,\r\n  currentSong: res,\r\n});\r\n\r\nconst changePlayListAction = (playList) => ({\r\n  type: actionTypes.CHANGE_PLAY_LIST,\r\n  playList,\r\n});\r\n\r\nconst changeCurrentSongIndexAction = (index) => ({\r\n  type: actionTypes.CHANGE_CURRENT_SONG_INDEX,\r\n  index,\r\n});\r\n\r\nexport const changeSequenceAction = (sequence) => ({\r\n  type: actionTypes.CHANGE_SEQUENCE,\r\n  sequence,\r\n});\r\n\r\n// 上一首，下一首\r\nexport const changeSongPlayerAction = (tag) => {\r\n  return (dispatch, getState) => {\r\n    const playList = getState().getIn([\"player\", \"playList\"]);\r\n    const sequence = getState().getIn([\"player\", \"sequence\"]);\r\n    let currentSongIndex = getState().getIn([\"player\", \"currentSongIndex\"]);\r\n    switch (sequence) {\r\n      case 1: // 随机播放\r\n        let randomIndex = getRandomNumber(playList.length);\r\n        while (randomIndex === currentSongIndex) {\r\n          randomIndex = getRandomNumber(playList.length);\r\n        }\r\n        currentSongIndex = randomIndex;\r\n        break;\r\n      default:\r\n        // 顺序 / 单曲播放\r\n        currentSongIndex += tag;\r\n        if (currentSongIndex >= playList.length) currentSongIndex = 0;\r\n        if (currentSongIndex < 0) currentSongIndex = playList.length - 1;\r\n        break;\r\n        const currentSong = playList[currentSongIndex];\r\n    }\r\n  };\r\n};\r\n\r\nexport const getSongDetailAction = (idx) => {\r\n  return (dispatch, getState) => {\r\n    // 1.根据ids查找playList中是否已经有该歌曲\r\n    const playList = getState().getIn([\"player\", \"playList\"]);\r\n    const songIndex = playList.findIndex((item) => item.id === idx);\r\n    // 如果返回的是大于0的下标，则表明找到了。\r\n    if (songIndex !== -1) {\r\n      dispatch(changeCurrentSongIndexAction(songIndex));\r\n      const songIds = playList[songIndex];\r\n      dispatch(changeCurrentSongAction(songIds));\r\n    } else {\r\n      // 如果返回的是-1，则表明没找到，则请求歌曲\r\n      getSongDetail(idx).then((res) => {\r\n        // res.songs && 防止 songs 是 undefined\r\n        const song = res.songs && res.songs[0];\r\n        // !song 防止 song 是 undefined，如果是 undefined什么也不做，直接结束执行\r\n        if (!song) return;\r\n        // 1.将最新请求的歌曲添加到播放列表中\r\n        const newPlayList = [...playList];\r\n        newPlayList.push(song);\r\n\r\n        // 2.更新redux中的值\r\n        dispatch(changePlayListAction(newPlayList));\r\n        dispatch(changeCurrentSongIndexAction(newPlayList.length - 1));\r\n        dispatch(changeCurrentSongAction(song));\r\n      });\r\n    }\r\n\r\n    // 列表中有歌曲，直接播放。\r\n    // 列表中没有歌曲，添加歌曲。\r\n\r\n    getSongDetail(idx).then((res) => {\r\n      dispatch(changeCurrentSongAction(res.songs[0]));\r\n    });\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}